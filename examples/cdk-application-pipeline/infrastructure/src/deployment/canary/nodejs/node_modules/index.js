const synthetics = require('Synthetics');
const log = require('SyntheticsLogger');

const url = process.env.url;
const threadCount = parseInt(process.env.threadCount);

const getAllFruits = async function () {
    const threads = [...Array(threadCount).keys()].map(id => 
        synthetics.executeHttpStep(`getAll`, `${url}/api/fruits`, (res) => {
            if (res.statusCode < 200 || res.statusCode > 299) {
                throw res.statusCode + ' ' + res.statusMessage;
            }
        })
    );
    await Promise.all(threads);
};

exports.handler = async () => {
    return await getAllFruits();
};